# 日语剧本翻译程序

## 简介

这是一个用于翻译日语剧本的工具集，由两个独立程序组成：词典编辑器和翻译程序。该工具集支持DeepSeek API和Ollama本地模型两种翻译方式，并具有以下特点：

- 保留原文档的所有换行符和格式
- 支持Excel格式的词典管理，便于编辑
- 自动识别专有名词并提供编辑功能
- 支持多词典管理和冲突检测
- 智能分割长文本，控制提示词长度
- 生成Word文档和文本文件两种格式的翻译结果

## 环境配置

### 系统要求

- 操作系统：Windows 10/11, macOS 10.14+, 或 Linux (Ubuntu 20.04+)
- Python 3.8 或更高版本
- 至少 4GB 内存
- 至少 500MB 磁盘空间

### 依赖库安装

程序运行需要以下Python库：

```bash
pip install PyQt6 python-docx requests python-dotenv jieba openpyxl pandas
```

各依赖库的作用：
- PyQt6: 图形用户界面
- python-docx: Word文档生成
- requests: API请求
- python-dotenv: 环境变量管理
- jieba: 中文分词
- openpyxl: Excel文件处理
- pandas: 数据处理

### API配置

如果使用DeepSeek API进行翻译，需要：
1. 注册DeepSeek账号并获取API密钥
2. 在翻译程序的设置中配置API密钥

如果使用Ollama本地模型进行翻译，需要：
1. 安装Ollama（https://ollama.ai/）
2. 下载所需的语言模型（如llama3）
3. 确保Ollama服务在本地运行（默认端口11434）
4. 在翻译程序的设置中配置Ollama URL和模型名称

## 程序结构

```
jp_translator/
├── 编辑词典.py          # 词典编辑器主程序
├── 翻译程序.py          # 翻译工具主程序
├── core/               # 核心功能模块
│   ├── file_processor.py       # 文件处理模块
│   ├── dictionary_manager.py   # 词典管理模块（旧版）
│   ├── translation_interface.py # 翻译接口模块
│   └── document_generator.py   # 文档生成模块
├── config/             # 配置文件目录
│   └── config.ini      # 配置文件
├── resources/          # 资源文件目录
│   ├── permanent_dict.json     # 永久词典（旧版）
│   └── temp_dict.json          # 临时词典（旧版）
└── test_files/         # 测试文件目录
    ├── test_jp.txt     # 测试用日语文本
    ├── test_dict1.xlsx # 测试词典1
    └── test_dict2.xlsx # 测试词典2
```

## 使用方法

### 词典编辑器（编辑词典.py）

词典编辑器是一个独立的工具，用于创建和管理Excel格式的词典：

1. 运行词典编辑器：
   ```bash
   python 编辑词典.py
   ```

2. 文件操作：
   - 点击"新建"创建新词典
   - 点击"打开"打开已有词典
   - 点击"保存"保存当前词典
   - 点击"另存为"将词典保存为新文件

3. 词条管理：
   - 点击"添加词条"手动添加新词条
   - 双击表格中的词条进行编辑
   - 选中词条后点击"删除词条"删除词条

4. 扫描文档：
   - 点击"扫描文档"打开扫描对话框
   - 选择日语文本文件并点击"开始扫描"
   - 从扫描结果中选择需要的词条添加到词典

5. 分类管理：
   - 点击"添加分类"创建新的分类
   - 在添加或编辑词条时可以选择分类

### 翻译程序（翻译程序.py）

翻译程序用于使用多个词典翻译日语文本：

1. 运行翻译程序：
   ```bash
   python 翻译程序.py
   ```

2. 文件选择：
   - 点击"浏览..."选择要翻译的日语文本文件

3. 词典管理：
   - 点击"添加词典"添加Excel格式的词典
   - 如果发现词典冲突，会弹出对话框让您选择使用哪个词典的翻译
   - 点击"移除词典"移除选中的词典
   - 点击"清空词典"移除所有词典

4. 翻译设置：
   - 点击"翻译设置"配置API密钥、翻译方法等

5. 翻译操作：
   - 点击"开始翻译"开始翻译过程
   - 翻译完成后，可以在"翻译"选项卡查看结果
   - 点击"保存结果"将翻译结果保存为Word文档或文本文件

## 词典格式说明

词典使用Excel格式（.xlsx）存储，包含以下列：

- **原文**：日语原文词条（必需）
- **翻译**：中文翻译（必需）
- **分类**：词条分类（可选）

